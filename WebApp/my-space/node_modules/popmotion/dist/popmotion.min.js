!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?r(exports):"function"==typeof define&&define.amd?define(["exports"],r):r((t=t||self).popmotion={})}(this,function(t){"use strict";var k=function(){return(k=Object.assign||function(t){for(var r,n=1,e=arguments.length;n<e;n++)for(var a in r=arguments[n])Object.prototype.hasOwnProperty.call(r,a)&&(t[a]=r[a]);return t}).apply(this,arguments)};function C(t){var r=t.from,n=void 0===r?0:r,e=t.to,f=void 0===e?0:e,a=t.velocity,s=void 0===a?0:a,o=t.stiffness,c=void 0===o?100:o,u=t.damping,p=void 0===u?10:u,i=t.mass,v=void 0===i?1:i,d=t.restSpeed,l=void 0===d?2:d,h=t.restDelta,m={done:!1,value:n},y=b,g=b;function M(){var e,a=s?-s/1e3:0,o=f-n,u=p/(2*Math.sqrt(c*v)),i=Math.sqrt(c/v)/1e3;null!=h||(h=Math.abs(f-n)<=1?.01:.4),u<1?(y=function(t){var r=Math.exp(-u*i*t),n=i*Math.sqrt(1-u*u);return f-r*((a+u*i*o)/n*Math.sin(n*t)+o*Math.cos(n*t))},g=function(t){var r=Math.exp(-u*i*t),n=i*Math.sqrt(1-u*u);return u*i*r*(Math.sin(n*t)*(a+u*i*o)/n+o*Math.cos(n*t))-r*(Math.cos(n*t)*(a+u*i*o)-n*o*Math.sin(n*t))}):y=1==u?function(t){var r=Math.exp(-i*t);return f-r*(o+(a+i*o)*t)}:(e=i*Math.sqrt(u*u-1),function(t){var r=Math.exp(-u*i*t),n=Math.min(e*t,300);return f-r*((a+u*i*o)*Math.sinh(n)+e*o*Math.cosh(n))/e})}return M(),{next:function(t){var r=y(t),n=1e3*g(t),e=Math.abs(n)<=l,a=Math.abs(f-r)<=h;return m.done=e&&a,m.value=m.done?f:r,m},flipTarget:function(){var t;s=-s,n=(t=[f,n])[0],f=t[1],M()}}}C.needsInterpolation=function(t,r){return"string"==typeof t||"string"==typeof r};function f(t,r,n){return-n*t+n*r+t}function r(r,n){return function(t){return Math.max(Math.min(t,n),r)}}function p(t){return t%1?Number(t.toFixed(5)):t}function n(t){return void 0!==t.red}function e(t){return void 0!==t.hue}var a,b=function(t){return 0},x=function(t,r,n){var e=r-t;return 0==e?1:(n-t)/e},s=/(-)?(\d[\d\.]*)/g,c=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))/gi,o=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2,3}\s*\/*\s*[\d\.]+%?\))$/i,u={test:function(t){return"number"==typeof t},parse:parseFloat,transform:function(t){return t}},v=k(k({},u),{transform:r(0,1)}),d=(k(k({},u),{default:1}),a="%",{test:function(t){return"string"==typeof t&&t.endsWith(a)&&1===t.split(" ").length},parse:parseFloat,transform:function(t){return""+t+a}}),i=(k(k({},d),{parse:function(t){return d.parse(t)/100},transform:function(t){return d.transform(100*t)}}),r(0,255));function l(o){return function(t){if("string"!=typeof t)return t;for(var r,n={},e=(r=t).substring(r.indexOf("(")+1,r.lastIndexOf(")")).replace(/(,|\/)/g," ").split(/ \s*/),a=0;a<4;a++)n[o[a]]=void 0!==e[a]?parseFloat(e[a]):1;return n}}var h=k(k({},u),{transform:function(t){return Math.round(i(t))}});function m(t,r){return t.startsWith(r)&&o.test(t)}function y(t){return"number"==typeof t?0:t}function g(t,r,n){var e=t*t,a=r*r;return Math.sqrt(Math.max(0,n*(a-e)+e))}function M(r){return F.find(function(t){return t.test(r)})}function O(t){return"number"==typeof t}function w(r,n){return function(t){return n(r(t))}}var A={test:function(t){return"string"==typeof t?m(t,"rgb"):n(t)},parse:l(["red","green","blue","alpha"]),transform:function(t){var r,n,e,a,o,u=t.red,i=t.green,f=t.blue,s=t.alpha,c=void 0===s?1:s;return r={red:h.transform(u),green:h.transform(i),blue:h.transform(f),alpha:p(v.transform(c))},n=r.red,e=r.green,a=r.blue,o=r.alpha,"rgba("+n+", "+e+", "+a+", "+(void 0===o?1:o)+")"}},I={test:function(t){return"string"==typeof t?m(t,"hsl"):e(t)},parse:l(["hue","saturation","lightness","alpha"]),transform:function(t){var r,n,e,a,o,u=t.hue,i=t.saturation,f=t.lightness,s=t.alpha,c=void 0===s?1:s;return r={hue:Math.round(u),saturation:d.transform(p(i)),lightness:d.transform(p(f)),alpha:p(v.transform(c))},n=r.hue,e=r.saturation,a=r.lightness,o=r.alpha,"hsla("+n+", "+e+", "+a+", "+(void 0===o?1:o)+")"}},P=k(k({},A),{test:function(t){return"string"==typeof t&&m(t,"#")},parse:function(t){var r="",n="",e="";return 4<t.length?(r=t.substr(1,2),n=t.substr(3,2),e=t.substr(5,2)):(r=t.substr(1,1),n=t.substr(2,1),e=t.substr(3,1),r+=r,n+=n,e+=e),{red:parseInt(r,16),green:parseInt(n,16),blue:parseInt(e,16),alpha:1}}}),T={test:function(t){return"string"==typeof t&&o.test(t)||n(t)||e(t)},parse:function(t){return A.test(t)?A.parse(t):I.test(t)?I.parse(t):P.test(t)?P.parse(t):t},transform:function(t){return n(t)?A.transform(t):e(t)?I.transform(t):t}},D="${c}",S="${n}",j={test:function(t){if("string"!=typeof t||!isNaN(t))return!1;var r=0,n=t.match(s),e=t.match(c);return n&&(r+=n.length),e&&(r+=e.length),0<r},parse:function(t){var r=t,n=[],e=r.match(c);e&&(r=r.replace(c,D),n.push.apply(n,e.map(T.parse)));var a=r.match(s);return a&&n.push.apply(n,a.map(u.parse)),n},createTransformer:function(t){var e=t,a=0,r=t.match(c),o=r?r.length:0;if(r)for(var n=0;n<o;n++)e=e.replace(r[n],D),a++;var u=e.match(s),i=u?u.length:0;if(u)for(n=0;n<i;n++)e=e.replace(u[n],S),a++;return function(t){for(var r=e,n=0;n<a;n++)r=r.replace(n<o?D:S,n<o?T.transform(t[n]):p(t[n]));return r}},getAnimatableNone:function(t){var r=j.parse(t);return j.createTransformer(t)(r.map(y))}},q=function(){},F=[P,A,I],E=function(t,r){var n=M(t),e=M(r);q(n.transform===e.transform);var a=n.parse(t),o=e.parse(r),u=k({},a),i=n===I?f:g;return function(t){for(var r in u)"alpha"!==r&&(u[r]=i(a[r],o[r],t));return u.alpha=f(a.alpha,o.alpha,t),n.transform(u)}},R={x:0,y:0,z:0},U=function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return t.reduce(w)};function z(r,n){return O(r)?function(t){return f(r,n,t)}:(T.test(r)?E:$)(r,n)}var N=function(t,n){var e=function(){for(var t=0,r=0,n=arguments.length;r<n;r++)t+=arguments[r].length;for(var e=Array(t),a=0,r=0;r<n;r++)for(var o=arguments[r],u=0,i=o.length;u<i;u++,a++)e[a]=o[u];return e}(t),a=e.length,o=t.map(function(t,r){return z(t,n[r])});return function(t){for(var r=0;r<a;r++)e[r]=o[r](t);return e}},W=function(t,r){var n=k(k({},t),r),e={};for(var a in n)void 0!==t[a]&&void 0!==r[a]&&(e[a]=z(t[a],r[a]));return function(t){for(var r in e)n[r]=e[r](t);return n}};function B(t){for(var r=j.parse(t),n=r.length,e=0,a=0,o=0,u=0;u<n;u++)e||"number"==typeof r[u]?e++:void 0!==r[u].hue?o++:a++;return{parsed:r,numNumbers:e,numRGB:a,numHSL:o}}var $=function(t,r){var n=j.createTransformer(r),e=B(t),a=B(r);return U(N(e.parsed,a.parsed),n)},_=function(t,r,n){return Math.min(Math.max(n,t),r)},G=function(r,n){return function(t){return f(r,n,t)}};function H(t,r,n){for(var e,a=[],o=n||("number"==typeof(e=t[0])?G:"string"==typeof e?T.test(e)?E:$:Array.isArray(e)?N:"object"==typeof e?W:void 0),u=t.length-1,i=0;i<u;i++){var f,s=o(t[i],t[i+1]);r&&(f=Array.isArray(r)?r[i]:r,s=U(f,s)),a.push(s)}return a}function L(r,t,n){var e=void 0===n?{}:n,a=e.clamp,o=void 0===a||a,u=e.ease,i=e.mixer,f=r.length;q(f===t.length),q(!u||!Array.isArray(u)||u.length===f-1),r[0]>r[f-1]&&(r=[].concat(r),t=[].concat(t),r.reverse(),t.reverse());var s,c,p,v,d,l,h,m,y,g=H(t,u,i),M=2===f?(l=g,h=(d=r)[0],m=d[1],y=l[0],function(t){return y(x(h,m,t))}):(c=g,p=(s=r).length,v=p-1,function(t){var r=0,n=!1;if(t<=s[0]?n=!0:t>=s[v]&&(r=v-1,n=!0),!n){for(var e=1;e<p&&!(s[e]>t||e===v);e++);r=e-1}var a=x(s[r],s[r+1],t);return c[r](a)});return o?function(t){return M(_(r[0],r[f-1],t))}:M}function V(r){return function(t){return 1-r(1-t)}}function J(r){return function(t){return t<=.5?r(2*t)/2:(2-r(2*(1-t)))/2}}function K(r){return function(t){return Math.pow(t,r)}}function Q(r){return function(t){return t*t*((r+1)*t-r)}}function X(t){var r=Q(t);return function(t){return(t*=2)<1?.5*r(t):.5*(2-Math.pow(2,-10*(t-1)))}}function Y(t){return t}function Z(t){return 1-Math.sin(Math.acos(t))}function tt(t){if(1===t||0===t)return t;var r=t*t;return t<4/11?7.5625*r:t<8/11?9.075*r-9.9*t+3.4:t<.9?4356/361*r-35442/1805*t+16061/1805:10.8*t*t-20.52*t+10.72}var rt=K(2),nt=V(rt),et=J(rt),at=V(Z),ot=J(at),ut=Q(1.525),it=V(ut),ft=J(ut),st=X(1.525),ct=V(tt);function pt(t){var r,n,e,a,o=t.from,u=void 0===o?0:o,i=t.to,f=void 0===i?1:i,s=t.ease,c=t.offset,p=t.duration,v=void 0===p?300:p,d={done:!1,value:u},l=Array.isArray(f)?f:[u,f],h=(r=null!=c?c:(a=(e=l).length,e.map(function(t,r){return 0!==r?r/(a-1):0})),n=v,r.map(function(t){return t*n}));function m(){return L(h,l,{ease:Array.isArray(s)?s:(r=s,(t=l).map(function(){return r||et}).splice(0,t.length-1))});var t,r}var y=m();return{next:function(t){return d.value=y(t),d.done=v<=t,d},flipTarget:function(){l.reverse(),y=m()}}}function vt(t){var r=t.velocity,n=void 0===r?0:r,e=t.from,a=void 0===e?0:e,o=t.power,u=void 0===o?.8:o,i=t.timeConstant,f=void 0===i?350:i,s=t.restDelta,c=void 0===s?.5:s,p=t.modifyTarget,v={done:!1,value:a},d=u*n,l=a+d,h=void 0===p?l:p(l);return h!==l&&(d=h-a),{next:function(t){var r=-d*Math.exp(-t/f);return v.done=!(c<r||r<-c),v.value=v.done?h:h+r,v},flipTarget:function(){}}}var dt={keyframes:pt,spring:C,decay:vt};function lt(t){return bt=t}function ht(t){return At[t].process(Ot)}var mt=0,yt="undefined"!=typeof window&&void 0!==window.requestAnimationFrame?function(t){return window.requestAnimationFrame(t)}:function(t){var r=Date.now(),n=Math.max(0,16.7-(r-mt));mt=r+n,setTimeout(function(){return t(mt)},n)},gt=1/60*1e3,Mt=!0,bt=!1,xt=!1,Ot={delta:0,timestamp:0},wt=["read","update","preRender","render","postRender"],At=wt.reduce(function(t,r){var e,o,u,i,f,a,s,c,p;return t[r]=(e=lt,o=[],f=!(u=[]),a=i=0,s=new WeakSet,c=new WeakSet,p={cancel:function(t){var r=u.indexOf(t);s.add(t),-1!==r&&u.splice(r,1)},process:function(t){var r,n;if(f=!0,o=(r=[u,o])[0],(u=r[1]).length=0,i=o.length)for(a=0;a<i;a++)(n=o[a])(t),!0!==c.has(n)||s.has(n)||(p.schedule(n),e(!0));f=!1},schedule:function(t,r,n){void 0===r&&(r=!1),void 0===n&&(n=!1);var e=n&&f,a=e?o:u;s.delete(t),r&&c.add(t),-1===a.indexOf(t)&&(a.push(t),e&&(i=o.length))}}),t},{}),It=wt.reduce(function(t,r){var e=At[r];return t[r]=function(t,r,n){return void 0===r&&(r=!1),void 0===n&&(n=!1),bt||Dt(),e.schedule(t,r,n),t},t},{}),Pt=wt.reduce(function(t,r){return t[r]=At[r].cancel,t},{}),Tt=function(t){bt=!1,Ot.delta=Mt?gt:Math.max(Math.min(t-Ot.timestamp,40),1),Mt||(gt=Ot.delta),Ot.timestamp=t,xt=!0,wt.forEach(ht),xt=!1,bt&&(Mt=!1,yt(Tt))},Dt=function(){Mt=bt=!0,xt||yt(Tt)};function St(t,r,n){return void 0===n&&(n=0),t-r-n}var jt=function(n){function t(t){var r=t.delta;return n(r)}return{start:function(){return It.update(t,!0,!0)},stop:function(){return Pt.update(t)}}};function qt(t){var r,o,u,i,n=t.from,e=t.autoplay,a=void 0===e||e,f=t.driver,s=void 0===f?jt:f,c=t.elapsed,p=void 0===c?0:c,v=t.repeat,d=void 0===v?0:v,l=t.repeatType,h=void 0===l?"loop":l,m=t.repeatDelay,y=void 0===m?0:m,g=t.onPlay,M=t.onStop,b=t.onComplete,x=t.onRepeat,O=t.onUpdate,w=function(t,r){var n={};for(var e in t)Object.prototype.hasOwnProperty.call(t,e)&&r.indexOf(e)<0&&(n[e]=t[e]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var a=0,e=Object.getOwnPropertySymbols(t);a<e.length;a++)r.indexOf(e[a])<0&&Object.prototype.propertyIsEnumerable.call(t,e[a])&&(n[e[a]]=t[e[a]]);return n}(t,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]),A=w.to,I=0,P=w.duration,T=!1,D=!0,S=function(t){if(Array.isArray(t.to))return pt;if(dt[t.type])return dt[t.type];var r=new Set(Object.keys(t));return!r.has("ease")&&!r.has("duration")&&(r.has("stiffness")||r.has("mass")||r.has("damping")||r.has("restSpeed")||r.has("restDelta"))?C:pt}(w);null!==(r=S.needsInterpolation)&&void 0!==r&&r.call(S,n,A)&&(i=L([0,100],[n,A],{clamp:!1}),n=0,A=100);var j=S(k(k({},w),{from:n,to:A}));function q(){var t,r,n,e;I++,"reverse"===h?(t=p,r=P,void 0===(n=y)&&(n=0),void 0===(e=D=I%2==0)&&(e=!0),p=e?St(r+-t,r,n):r-(t-r)+n):(p=St(p,P,y),"mirror"===h&&j.flipTarget()),T=!1,x&&x()}function F(t){var r,n,e,a;D||(t=-t),p+=t,T||(r=j.next(Math.max(0,p)),u=r.value,i&&(u=i(u)),T=D?r.done:p<=0),null!=O&&O(u),T&&(0===I&&(null!=P||(P=p)),I<d?(n=p,e=P,a=y,(D?e+a<=n:n<=-a)&&q()):(o.stop(),b&&b()))}return a&&(null!=g&&g(),(o=s(F)).start()),{stop:function(){null!=M&&M(),o.stop()}}}function Ft(t,r){return r?t*(1e3/r):0}function kt(t){return 180*t/Math.PI}function Ct(t){return t}function Et(o){return void 0===o&&(o=Ct),function(t,r,n){var e=r-n,a=-(0-t+1)*(0-o(Math.abs(e)));return e<=0?r+a:r-a}}function Rt(t){return t*Math.PI/180}function Ut(t){return t.hasOwnProperty("x")&&t.hasOwnProperty("y")}function zt(t){return Ut(t)&&t.hasOwnProperty("z")}function Nt(t,r){return Math.abs(t-r)}var Wt=Et(),Bt=Et(Math.sqrt);function $t(t,r){return void 0===r&&(r=2),r=Math.pow(10,r),Math.round(t*r)/r}function _t(t,r,n,e){return void 0===e&&(e=0),$t(t+n*(r-t)/Math.max(e,n))}function Gt(t,r){return 1-3*r+3*t}function Ht(t,r){return 3*r-6*t}var Lt=function(t,r,n){return((Gt(r,n)*t+Ht(r,n))*t+3*r)*t},Vt=function(t,r,n){return 3*Gt(r,n)*t*t+2*Ht(r,n)*t+3*r},Jt=1e-7,Kt=10;var Qt=8;t.angle=function(t,r){return void 0===r&&(r=R),kt(Math.atan2(r.y-t.y,r.x-t.x))},t.animate=qt,t.anticipate=st,t.applyOffset=function(r,n){var e=!0;return void 0===n&&(n=r,e=!1),function(t){return e?t-r+n:(r=t,e=!0,n)}},t.attract=Wt,t.attractExpo=Bt,t.backIn=ut,t.backInOut=ft,t.backOut=it,t.bounceIn=ct,t.bounceInOut=function(t){return t<.5?.5*(1-tt(1-2*t)):.5*tt(2*t-1)+.5},t.bounceOut=tt,t.circIn=Z,t.circInOut=ot,t.circOut=at,t.clamp=_,t.createAnticipate=X,t.createAttractor=Et,t.createBackIn=Q,t.createExpoIn=K,t.cubicBezier=function(o,r,u,n){if(o===r&&u===n)return Y;for(var i=new Float32Array(11),t=0;t<11;++t)i[t]=Lt(.1*t,o,u);function e(t){for(var r=0,n=1;10!==n&&i[n]<=t;++n)r+=.1;var e=r+.1*((t-i[--n])/(i[n+1]-i[n])),a=Vt(e,o,u);return.001<=a?function(t,r,n,e){for(var a=0;a<Qt;++a){var o=Vt(r,n,e);if(0===o)return r;r-=(Lt(r,n,e)-t)/o}return r}(t,e,o,u):0===a?e:function(t,r,n,e,a){for(var o,u,i=0;0<(o=Lt(u=r+(n-r)/2,e,a)-t)?n=u:r=u,Math.abs(o)>Jt&&++i<Kt;);return u}(t,r,r+.1,o,u)}return function(t){return 0===t||1===t?t:Lt(e(t),r,n)}},t.decay=vt,t.degreesToRadians=Rt,t.distance=function(t,r){if(O(t)&&O(r))return Nt(t,r);if(Ut(t)&&Ut(r)){var n=Nt(t.x,r.x),e=Nt(t.y,r.y),a=zt(t)&&zt(r)?Nt(t.z,r.z):0;return Math.sqrt(Math.pow(n,2)+Math.pow(e,2)+Math.pow(a,2))}},t.easeIn=rt,t.easeInOut=et,t.easeOut=nt,t.inertia=function(t){var r,n,e,a,o,u,i=t.from,f=void 0===i?0:i,s=t.velocity,c=void 0===s?0:s,p=t.min,v=t.max,d=t.power,l=void 0===d?.8:d,h=t.timeConstant,m=void 0===h?750:h,y=t.bounceStiffness,g=void 0===y?500:y,M=t.bounceDamping,b=void 0===M?10:M,x=t.restDelta,O=void 0===x?1:x,w=t.modifyTarget,A=t.driver,I=t.onUpdate,P=t.onComplete;function T(t){return void 0!==p&&t<p||void 0!==v&&v<t}function D(t){return void 0!==p&&(void 0===v||Math.abs(p-t)<Math.abs(v-t))?p:v}function S(n){null!=r&&r.stop(),r=qt(k(k({},n),{driver:A,onUpdate:function(t){var r;null!=I&&I(t),null!==(r=n.onUpdate)&&void 0!==r&&r.call(n,t)},onComplete:P}))}function j(t){S(k({type:"spring",stiffness:g,damping:b,restDelta:O},t))}return T(f)?j({from:f,velocity:c,to:D(f)}):(n=l*c+f,void 0!==w&&(n=w(n)),e=D(n),a=e===p?-1:1,S({type:"decay",from:f,velocity:c,timeConstant:m,power:l,restDelta:O,modifyTarget:w,onUpdate:T(n)?function(t){o=u,c=Ft((u=t)-o,Ot.delta),(1==a&&e<t||-1==a&&t<e)&&j({from:t,to:e,velocity:c})}:void 0})),{stop:function(){return null==r?void 0:r.stop()}}},t.interpolate=L,t.isPoint=Ut,t.isPoint3D=zt,t.keyframes=pt,t.linear=Y,t.mirrorEasing=J,t.mix=f,t.mixColor=E,t.mixComplex=$,t.pipe=U,t.pointFromVector=function(t,r,n){return r=Rt(r),{x:n*Math.cos(r)+t.x,y:n*Math.sin(r)+t.y}},t.progress=x,t.radiansToDegrees=kt,t.reverseEasing=V,t.smooth=function(a){void 0===a&&(a=50);var o=0,u=0;return function(t){var r=Ot.timestamp,n=r!==u?r-u:0,e=n?_t(o,t,n,a):o;return u=r,o=e}},t.smoothFrame=_t,t.snap=function(a){if("number"==typeof a)return function(t){return Math.round(t/a)*a};var o=0,u=a.length;return function(t){var r=Math.abs(a[0]-t);for(o=1;o<u;o++){var n=a[o],e=Math.abs(n-t);if(0===e)return n;if(r<e)return a[o-1];if(o===u-1)return n;r=e}}},t.spring=C,t.steps=function(e,a){return void 0===a&&(a="end"),function(t){var r=(t="end"===a?Math.min(t,.999):Math.max(t,.001))*e,n="end"===a?Math.floor(r):Math.ceil(r);return _(0,1,n/e)}},t.toDecimal=$t,t.velocityPerFrame=function(t,r){return t/(1e3/r)},t.velocityPerSecond=Ft,t.wrap=function(t,r,n){var e=r-t;return((n-t)%e+e)%e+t},Object.defineProperty(t,"__esModule",{value:!0})});
